<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZelStream - Direct Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #0f1014; color: #f3f4f6; font-family: sans-serif; }
        .skeleton {
            background: linear-gradient(90deg, #1a1b1e 25%, #27282e 50%, #1a1b1e 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; background: #000; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    </style>
</head>
<body class="overflow-x-hidden">

    <nav class="fixed top-0 w-full z-50 bg-[#0f1014]/95 border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <h1 class="text-2xl font-black text-red-600 cursor-pointer" onclick="location.reload()">ZELSTREAM</h1>
            <div class="hidden md:flex gap-6 text-sm font-medium text-gray-400">
                <button onclick="app.fetchCategory('trending')" class="hover:text-white">Trending</button>
                <button onclick="app.fetchCategory('indonesian-movies')" class="hover:text-white">Indonesia</button>
                <button onclick="app.fetchCategory('kdrama')" class="hover:text-white">K-Drama</button>
                <button onclick="app.fetchCategory('anime')" class="hover:text-white">Anime</button>
            </div>
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Cari..." class="bg-white/5 border border-white/10 rounded-full py-1.5 px-4 text-sm focus:outline-none w-40 md:w-64">
            </div>
        </div>
    </nav>

    <main class="pt-20 pb-10">
        <div class="max-w-7xl mx-auto px-4">
            <h2 id="section-title" class="text-2xl font-bold mb-8">Trending</h2>
            <div id="movie-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
        </div>
    </main>

    <div id="detail-modal" class="fixed inset-0 z-[60] hidden bg-black/98 overflow-y-auto">
        <div id="modal-body" class="min-h-screen p-4 md:p-10"></div>
        <button onclick="app.closeModal()" class="fixed top-4 right-4 p-2 bg-white/10 rounded-full hover:bg-red-600 transition">
            <i data-lucide="x"></i>
        </button>
    </div>

    <script>
        const app = {
            // Gunakan HTTPS jika tersedia, jika tidak tetap gunakan HTTP
            API_URL: "https://zeldvorik.ru/apiv2/api.php",

            init() {
                lucide.createIcons();
                this.setupSearch();
                this.fetchCategory('trending');
            },

            setupSearch() {
                const input = document.getElementById('searchInput');
                let timer;
                input.addEventListener('input', (e) => {
                    clearTimeout(timer);
                    timer = setTimeout(() => {
                        if (e.target.value.length > 2) this.search(e.target.value);
                        else if (e.target.value.length === 0) this.fetchCategory('trending');
                    }, 500);
                });
            },

            async fetchData(params) {
                try {
                    const response = await fetch(`${this.API_URL}?${params}`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    return await response.json();
                } catch (error) {
                    console.error("Fetch Error:", error);
                    return null;
                }
            },

            async fetchCategory(action) {
                this.showSkeleton();
                const data = await this.fetchData(`action=${action}&page=1`);
                if (data && data.success) {
                    document.getElementById('section-title').innerText = action.toUpperCase().replace('-', ' ');
                    this.renderGrid(data.items);
                }
            },

            async search(q) {
                this.showSkeleton();
                const data = await this.fetchData(`action=search&q=${encodeURIComponent(q)}`);
                if (data && data.success) {
                    document.getElementById('section-title').innerText = `Hasil: ${q}`;
                    this.renderGrid(data.items);
                }
            },

            renderGrid(items) {
                const grid = document.getElementById('movie-grid');
                grid.innerHTML = items.map(item => `
                    <div class="group cursor-pointer" onclick="app.showDetail('${item.detailPath}')">
                        <div class="aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 mb-2 ring-1 ring-white/5 group-hover:ring-red-600 transition">
                            <img src="${item.poster}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500" loading="lazy">
                        </div>
                        <h3 class="text-sm font-semibold truncate">${item.title}</h3>
                        <p class="text-xs text-gray-500">${item.year} • ★${item.rating}</p>
                    </div>
                `).join('');
            },

            async showDetail(path) {
                const modal = document.getElementById('detail-modal');
                const body = document.getElementById('modal-body');
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                body.innerHTML = `<div class="h-screen flex items-center justify-center text-red-600 animate-pulse">Memuat Detail...</div>`;

                // PERBAIKAN: Bersihkan path jika mengandung slash ganda
                const cleanPath = path.startsWith('/') ? path.substring(1) : path;
                const data = await this.fetchData(`action=detail&detailPath=${cleanPath}`);

                if (data && data.success) {
                    const it = data.item;
                    body.innerHTML = `
                        <div class="max-w-5xl mx-auto pt-8">
                            <div class="flex flex-col md:flex-row gap-8 mb-10">
                                <img src="${it.poster}" class="w-full md:w-64 rounded-xl shadow-xl">
                                <div>
                                    <h2 class="text-3xl md:text-5xl font-black mb-2">${it.title}</h2>
                                    <p class="text-yellow-500 font-bold mb-4">Rating: ★ ${it.rating} | ${it.year}</p>
                                    <p class="text-gray-400 text-sm leading-relaxed mb-6">${it.description || 'Tidak ada deskripsi.'}</p>
                                    <div class="video-wrapper">
                                        <iframe src="${it.playerUrl}" allowfullscreen></iframe>
                                    </div>
                                </div>
                            </div>
                            ${it.seasons ? this.renderSeasons(it.seasons) : ''}
                        </div>`;
                    lucide.createIcons();
                } else {
                    body.innerHTML = `<div class="h-screen flex flex-col items-center justify-center">
                        <p class="text-xl font-bold">Gagal memuat detail konten.</p>
                        <p class="text-gray-500 text-sm mt-2 text-center">API mungkin sedang sibuk atau URL tidak valid.<br>Path: ${path}</p>
                        <button onclick="app.closeModal()" class="mt-6 bg-red-600 px-6 py-2 rounded-full text-sm">Kembali</button>
                    </div>`;
                }
            },

            renderSeasons(seasons) {
                return seasons.map(s => `
                    <div class="mb-8">
                        <h4 class="text-lg font-bold mb-4 text-red-500">${s.seasonName}</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-2">
                            ${s.episodes.map(ep => `
                                <button onclick="app.changePlayer('${ep.url}')" class="bg-white/5 hover:bg-red-600 p-2 rounded text-xs truncate transition">
                                    ${ep.episodeName}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            },

            changePlayer(url) {
                const frame = document.querySelector('iframe');
                frame.src = url;
                frame.scrollIntoView({ behavior: 'smooth', block: 'center' });
            },

            closeModal() {
                document.getElementById('detail-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            },

            showSkeleton() {
                document.getElementById('movie-grid').innerHTML = Array(10).fill(0).map(() => `
                    <div><div class="aspect-[2/3] rounded-lg skeleton mb-2"></div><div class="h-3 w-3/4 skeleton rounded"></div></div>
                `).join('');
            }
        };

        app.init();
    </script>
</body>
</html>
